<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>播放器小窗续播功能demo</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <style>
        div {
            /*-webkit-overflow-scrolling: touch;*/
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: auto;
            margin: 0;
            padding: 0;
        }

        #list {
            z-index: 1;
            opacity: 1;
        }

        #video_intro {
        }

        #block {
            width: 100%;
            /*height: 56.25%;*/
            visibility: hidden;
            right: 0;
            box-sizing: border-box;
            background-color: black;
            position: fixed;
            /*position: absolute;*/
            z-index: 3;
        }

        #intro {
            display: none;
            z-index: 2;
            position: absolute;
        }

    </style>
    <script src="../js/lib/jquery.min.js"></script>
    <script src="../js/lib/touch.js"></script>
</head>
<body>
<div id="list">
    <a id="a1"><img id="img1" src="../images/le.png" style="width:100%;height:auto;"><br>
        <div style="padding-left: 40%;">乐视宣传片</div>
    </a><br>
    <a id="a2"><img src="../images/greatwall.png" style="width:100%;height:auto;"><br>
        <div style="padding-left: 30%;">电影长城宣传片</div>
    </a><br>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    <!--touchend,touchcancel<br/>-->
    <!--touchstart,touchmove<br/>-->
    <!--touchend,touchcancel<br/>touchstart,touchmove<br/>-->
    <!--touchend,touchcancel<br/>-->
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    ouchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchstart,touchmove<br/>
    touchstart,touchmove<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    ouchstart,touchmove<br/>
    touchend,touchcancel<br/>
    touchstart,touchmove<br/>
    touchstart,touchmove<br/>
    touchend,touchcancel<br/>
    <!--touchstart,touchmove<br/>-->
    <!--touchstart,touchmove<br/>-->
    touchend,touchcancel3333333333333333333333
</div>
<div id="video_intro">
    <video id="block" style="width: 100%;top: 0;" controls>
        <source id="source1" src="../video/greatwall.mp4" type="video/mp4"/>
        您的浏览器不支持Html5的video标签。请更换别的浏览器。
    </video>
    <div id="intro">
        111视频介绍视频介绍视频绍视频介绍1视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        222绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        333绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        444绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        555绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        666绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        777绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        888绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        999绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介
        绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍视频介绍
    </div>
</div>

<script>
    var block = document.getElementById("block");
    var source1 = document.getElementById("source1");
    var list = document.getElementById("list");
    var intro = document.getElementById("intro");
    var a1 = document.getElementById('a1');
    var a2 = document.getElementById('a2');
    var oW, oH; // 点击位置到元素左侧/顶部距离
    var visibleWidth = document.documentElement.clientWidth;
    var visibleHeight = document.documentElement.clientHeight;
    var introTop = block.offsetHeight;
    intro.style.top = introTop + block.offsetTop + 10 + "px";
    var ratio = 9 / 16;
    var oTop = 0;
    var endPercentWidth = 50; // 视频在右下角时所占的百分比数值,比如:30
    var endBottom = 7; // 视频在右下角时距屏幕底部距离,比如:5
    var endRight = 7; // 视频在右下角时距屏幕右部距离,比如:5

    block.addEventListener("touchstart", function (e) {
        intro.style.display = "block";
        intro.style.top = block.offsetHeight + block.offsetTop + 10 + "px";
        var touches = e.touches[0];
        oW = touches.clientX - block.offsetLeft; // 点击位置到元素左侧距离 = 点击位置距左侧距离-元素距左侧距离位置
        oH = touches.clientY - block.offsetTop;
        document.addEventListener("touchmove", _preventDefault);
    }, false);

    block.addEventListener("touchmove", function (e) {
        var touches = e.touches[0];
        var oLeft = touches.clientX - oW; // 元素距左侧距离 = 点击位置距左侧距离-点击位置到元素左侧距离
        oTop = touches.clientY - oH; // 元素距顶部距离
        if (oLeft < 0) {
            oLeft = 0;
        } else if (oLeft > visibleWidth - block.offsetWidth - endRight) {
            oLeft = (visibleWidth - block.offsetWidth - endRight);
        }
        if (oTop < 0) {
            oTop = 0;
        } else if (oTop > visibleHeight - block.offsetHeight - endBottom) {
            oTop = (visibleHeight - block.offsetHeight - endBottom);
        }

        block.style.top = oTop + "px";
        // 计算video的百分比宽度
        // 100 - (100 -最后变成的百分比数值) * video距顶距离 / (屏幕高度-视频高度-视频在右下角时距屏幕底部距离)
        var changingWidth = 100 - (100 - endPercentWidth) * oTop / (visibleHeight - block.offsetHeight - endBottom);
        // 计算list的透明度
        //  video距顶距离 / (屏幕高度-视频高度-视频在右下角时距屏幕底部距离)
        list.style.opacity = oTop / (visibleHeight - block.offsetHeight - endBottom);
        // 计算video在滑动过程中距右侧距离
        // 视频在右下角时距屏幕右部距离 * video距顶距离 / (屏幕高度-视频高度-视频在右下角时距屏幕底部距离)
        block.style.right = endRight * oTop / (visibleHeight - block.offsetHeight - endBottom) + 'px';
        // 计算video在滑动过程中距底部距离
        // 视频在右下角时距屏幕底部距离 * video距顶距离 / (屏幕高度-视频高度-视频在右下角时距屏幕底部距离)
        block.style.bottom = endBottom * oTop / (visibleHeight - block.offsetHeight - endBottom) + 'px';
        block.style.width = changingWidth + '%';
//        block.style.height = ratio * changingWidth + '%';
        intro.style.top = block.offsetHeight + 10 + oTop + "px";
    }, false);

    block.addEventListener("touchend", function () {
        list.style.opacity = 1;
        document.removeEventListener("touchmove", _preventDefault);
//        if (block.offsetTop < screen.height / 3) {
        if (block.offsetTop < visibleHeight / 3) {
//            block.style = 'top:0;visibility:visible;';
            block.style.visibility = "visible";
            block.style.width = "100%";
            block.style.top = "0";
            intro.style.top = block.offsetHeight + 10 + "px";
            list.style.opacity = 0;
            window.scrollTo(0, 0);
        }
        if (block.offsetTop >= visibleHeight / 3) {
//            block.style = "width:" + endPercentWidth + "%;bottom:" + endBottom + "px;right:" + endRight + "px;visibility:visible;position:fixed;";
            block.style.width = endPercentWidth + "%";
            block.style.top = "";
            block.style.bottom = endBottom + "px";
            block.style.right = endRight + "px";
            block.style.visibility = "visible";
            block.style.position = "fixed";
//            block.style = "width:" + endPercentWidth + "%;bottom:" + endBottom + "px;right:" + endRight + "px;height:" + ratio * 70 + '%';
            intro.style.display = "none";
            list.style.opacity = 1;
        }
    }, false);

    function orientationChange() {
        switch (window.orientation) {
            case 90:
            case -90:
                console.log("横屏");
                setTimeout(function () {
                    var videoHeight1 = block.offsetHeight;
                    intro.style.top = videoHeight1 + 10 + "px";
                }, 200);
                break;
            default:
                setTimeout(function () {
                    console.log("竖屏");
                    var videoHeight2 = block.offsetHeight;
                    intro.style.top = videoHeight2 + 10 + "px";
                }, 200);
                break;
        }
    }

    window.addEventListener("onorientationchange" in window ? "orientationchange" : "resize", orientationChange);

    $("#a1").on("tap", function () {
        //        window.scrollTo(0, 0);
//        block.style = "visibility:visible;width:100%;top:0;";
        block.style.visibility = "visible";
        block.style.width = "100%";
        block.style.top = "0";
        //        source1.src = '../video/le.mp4';
        var top = block.offsetHeight + 10;
//        intro.style = "display:block;width:100%;top:" + top + "px;";
        intro.style.display = "block";
        intro.style.width = "100%";
        intro.style.top = top + "px";
        list.style.opacity = '0';
        list.style.filter = 'alpha(opacity=0)';
    })
    ;
    $("#a2").on('tap', function () {
        window.scrollTo(0, 0);
//        block.style = "visibility:visible;width:100%;top:0;";
        block.style.visibility = "visible";
        block.style.width = "100%";
        block.style.top = "0";
//        source1.src = '../video/greatwall.mp4';
        var top = block.offsetHeight + 10;
//        intro.style = "display:block;width:100%;top:" + top + "px;";
        intro.style.display = "block";
        intro.style.width = "100%";
        intro.style.top = top + "px";
        list.style.opacity = '0';
    });

    function _preventDefault(e) {
        e.preventDefault();
    }
</script>
</body>
</html>